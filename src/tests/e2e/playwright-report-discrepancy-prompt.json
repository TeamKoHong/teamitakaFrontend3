{
  "meta": {
    "name": "Playwright 리포트 차이 분석 프롬프트",
    "version": "1.0",
    "purpose": "수동 대시보드와 실제 Playwright 리포트 간 차이 분석 및 테스트 실패 원인 진단",
    "created_at": "2025-12-21",
    "related_files": [
      "playwright-report-analysis-prompt.json",
      "playwright-report-deploy-prompt.json",
      "test-analysis-prompt.json"
    ]
  },

  "context": {
    "question_1": "playwright-report/index.html이 더 정확한 거 아님?",
    "answer_1": {
      "short": "맞습니다. playwright-report가 실제 테스트 결과입니다.",
      "detail": "e2e-test-dashboard.html은 특정 시점의 결과를 수동으로 하드코딩한 정적 파일이고, playwright-report/index.html은 Playwright가 테스트 실행 후 자동 생성하는 동적 리포트입니다."
    },

    "question_2": "그러면 프로젝트에 문제가 많단 소리인데?",
    "answer_2": {
      "short": "네, 현재 166개 테스트가 실패하고 있어 심각한 상태입니다.",
      "detail": "test-results/.last-run.json 파일에 따르면 status가 'failed'이고, failedTests 배열에 166개의 실패한 테스트 ID가 있습니다. 이는 테스트 환경, 코드 변경, 또는 백엔드 API 변경 등의 원인으로 발생했을 가능성이 높습니다."
    }
  },

  "discrepancy_analysis": {
    "comparison_table": {
      "headers": ["항목", "e2e-test-dashboard.html", "playwright-report (실제)"],
      "rows": [
        ["데이터 소스", "수동 입력 (하드코딩)", "자동 생성 (테스트 결과)"],
        ["상태", "성공", "failed"],
        ["총 테스트", "66개", "~166개+"],
        ["통과", "63개", "0개 (추정)"],
        ["실패", "0개", "166개"],
        ["스킵", "3개", "알 수 없음"],
        ["성공률", "95.5%", "~0%"],
        ["최신성", "과거 특정 시점", "가장 최근 테스트 실행"]
      ]
    },

    "why_different": {
      "reason_1": {
        "title": "수동 대시보드의 한계",
        "description": "e2e-test-dashboard.html은 개발자가 직접 HTML을 작성하고 숫자를 입력한 정적 파일입니다. 테스트를 실행해도 자동으로 업데이트되지 않습니다."
      },
      "reason_2": {
        "title": "시간 경과에 따른 불일치",
        "description": "대시보드 작성 이후 코드, UI, API가 변경되면서 테스트가 실패하기 시작했지만, 대시보드는 그대로 유지되었습니다."
      },
      "reason_3": {
        "title": "동기화 메커니즘 부재",
        "description": "테스트 결과를 대시보드에 자동으로 반영하는 시스템이 없어 두 리포트가 분리되어 있습니다."
      }
    }
  },

  "current_status_diagnosis": {
    "data_source": "test-results/.last-run.json",
    "status": "failed",
    "failed_tests_count": 166,
    "severity": "critical",
    "impact": "E2E 테스트 신뢰성 없음 - 실제 기능 검증 불가능"
  },

  "failure_patterns": {
    "description": "166개 실패 테스트의 주요 원인 패턴 분류",
    "patterns": {
      "AUTH": {
        "name": "인증 관련 실패",
        "symptoms": ["로그인 실패", "토큰 만료", "권한 없음 에러"],
        "possible_causes": [
          "테스트 계정 만료 또는 비활성화",
          "인증 토큰이 만료됨",
          "백엔드 인증 로직 변경"
        ],
        "priority": "highest"
      },
      "SELECTOR": {
        "name": "셀렉터 불일치",
        "symptoms": ["Element not found", "Timeout waiting for selector"],
        "possible_causes": [
          "UI 컴포넌트 구조 변경",
          "클래스명, ID, data-testid 변경",
          "동적 렌더링 타이밍 문제"
        ],
        "priority": "high"
      },
      "API": {
        "name": "API 관련 실패",
        "symptoms": ["Network error", "500 에러", "404 에러"],
        "possible_causes": [
          "백엔드 API 엔드포인트 변경",
          "API 스키마 변경",
          "백엔드 서버 다운"
        ],
        "priority": "highest"
      },
      "TIMING": {
        "name": "타이밍 관련 실패",
        "symptoms": ["Timeout", "Element not visible"],
        "possible_causes": [
          "비동기 로딩 시간 증가",
          "네트워크 지연",
          "waitFor 시간 부족"
        ],
        "priority": "medium"
      },
      "STATE": {
        "name": "상태 관련 실패",
        "symptoms": ["Unexpected state", "Data mismatch"],
        "possible_causes": [
          "테스트 데이터 변경 또는 삭제",
          "이전 테스트의 side effect",
          "데이터베이스 상태 불일치"
        ],
        "priority": "medium"
      }
    }
  },

  "diagnosis_workflow": {
    "description": "테스트 실패 원인 진단 워크플로우",
    "steps": [
      {
        "step": 1,
        "action": "실패 현황 파악",
        "command": "cat test-results/.last-run.json | jq '.failedTests | length'",
        "expected_output": "실패한 테스트 수"
      },
      {
        "step": 2,
        "action": "리포트 배포 및 확인",
        "command": "vercel playwright-report --prod --yes",
        "expected_output": "배포 URL에서 상세 실패 정보 확인"
      },
      {
        "step": 3,
        "action": "실패 테스트 필터링",
        "ui_action": "배포된 리포트에서 Failed 필터 클릭",
        "expected_output": "실패 테스트 목록"
      },
      {
        "step": 4,
        "action": "실패 패턴 분류",
        "description": "에러 메시지를 기반으로 AUTH, SELECTOR, API, TIMING, STATE 패턴 분류",
        "reference": "failure_patterns 섹션 참조"
      },
      {
        "step": 5,
        "action": "우선순위 결정",
        "criteria": [
          "AUTH 패턴: 최우선 (인증 실패 시 다른 테스트도 실패)",
          "API 패턴: 높음 (백엔드 연동 확인 필요)",
          "SELECTOR 패턴: 중간 (UI 변경 반영)",
          "TIMING/STATE: 낮음 (환경 설정 조정)"
        ]
      },
      {
        "step": 6,
        "action": "수정 및 재테스트",
        "command": "npx playwright test --grep 'M01' --reporter=line",
        "description": "모듈별로 수정 후 해당 모듈만 테스트"
      }
    ]
  },

  "recommended_actions": {
    "immediate": [
      {
        "priority": 1,
        "action": "테스트 환경 점검",
        "details": [
          "테스트 계정 로그인 가능 여부 확인",
          "API 서버 상태 확인",
          "환경 변수 및 설정 파일 확인"
        ]
      },
      {
        "priority": 2,
        "action": "AUTH 패턴 수정",
        "details": [
          "테스트 계정 재생성 또는 갱신",
          "인증 토큰 갱신 로직 확인",
          "테스트 전 로그인 fixture 점검"
        ]
      }
    ],
    "short_term": [
      {
        "priority": 3,
        "action": "SELECTOR 패턴 수정",
        "details": [
          "변경된 UI 컴포넌트 셀렉터 업데이트",
          "data-testid 속성 활용으로 안정성 향상",
          "동적 대기 로직 개선"
        ]
      },
      {
        "priority": 4,
        "action": "API 패턴 수정",
        "details": [
          "변경된 API 엔드포인트 반영",
          "목 데이터 업데이트",
          "API 스키마 검증"
        ]
      }
    ],
    "long_term": [
      {
        "priority": 5,
        "action": "대시보드 자동화 구축",
        "details": [
          "테스트 실행 후 대시보드 자동 업데이트",
          "CI/CD 파이프라인에 리포트 생성 통합",
          "수동 대시보드 폐기 또는 Playwright 리포트로 대체"
        ]
      }
    ]
  },

  "quick_prompts": {
    "diagnose": "현재 Playwright 테스트가 166개 실패하고 있어. test-results/.last-run.json과 playwright-report를 분석해서 실패 원인을 패턴별로 분류해줘. 분석 참조: src/tests/e2e/playwright-report-discrepancy-prompt.json",

    "compare_reports": "e2e-test-dashboard.html과 playwright-report/index.html의 차이점을 분석하고, 왜 숫자가 다른지 설명해줘.",

    "fix_priority": "166개 실패 테스트 중 가장 먼저 수정해야 할 패턴과 테스트를 우선순위별로 정리해줘.",

    "sync_dashboard": "테스트 결과에 맞게 e2e-test-dashboard.html을 업데이트하거나, 자동으로 대시보드를 생성하는 방법을 제안해줘."
  },

  "ai_prompt": {
    "system": "당신은 E2E 테스트 전문가입니다. Playwright 테스트 실패 원인을 분석하고 해결책을 제시합니다.",
    "user_template": "현재 Playwright 테스트 상태를 분석해주세요.\n\n## 현황\n- e2e-test-dashboard.html: 66테스트, 0실패, 95.5% 성공률 (수동 입력)\n- playwright-report: status=failed, 166개 테스트 실패\n\n## 질문\n1. 왜 두 리포트가 이렇게 다른가?\n2. 어느 것이 정확한 결과인가?\n3. 프로젝트에 심각한 문제가 있는 것인가?\n4. 어떻게 해결해야 하는가?\n\n## 분석 참조\nsrc/tests/e2e/playwright-report-discrepancy-prompt.json"
  },

  "integration": {
    "with_analysis_prompt": {
      "description": "실패 테스트 상세 분석 시 사용",
      "file": "playwright-report-analysis-prompt.json",
      "when": "배포된 리포트에서 개별 실패 테스트 분석 시"
    },
    "with_deploy_prompt": {
      "description": "리포트 배포 시 사용",
      "file": "playwright-report-deploy-prompt.json",
      "when": "상세 분석을 위해 리포트를 Vercel에 배포할 때"
    },
    "with_test_analysis": {
      "description": "실패 패턴 분류 및 해결책 참조",
      "file": "test-analysis-prompt.json",
      "when": "실패 패턴별 해결책 도출 시"
    }
  }
}
