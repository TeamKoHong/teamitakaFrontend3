{
  "meta": {
    "name": "Playwright 리포트 페이지 분석 프롬프트",
    "version": "1.0",
    "purpose": "배포된 Playwright HTML 리포트 페이지를 분석하고 테스트 결과를 점검",
    "created_at": "2025-12-20",
    "related_files": [
      "test-analysis-prompt.json"
    ]
  },

  "report_info": {
    "url_pattern": "https://*.vercel.app/",
    "example_url": "https://playwright-report-azure.vercel.app/",
    "report_type": "Playwright HTML Report",
    "features": [
      "테스트 결과 요약 (passed/failed/flaky/skipped)",
      "테스트별 상세 정보",
      "실패 스크린샷 및 비디오",
      "에러 메시지 및 스택 트레이스",
      "테스트 실행 시간"
    ]
  },

  "report_structure": {
    "header": {
      "description": "리포트 상단 요약 영역",
      "elements": {
        "title": "Playwright Test Report",
        "stats_bar": "passed/failed/flaky/skipped 수치 표시",
        "filter_buttons": "결과별 필터링 버튼"
      }
    },
    "test_list": {
      "description": "테스트 목록 영역",
      "elements": {
        "test_file": "테스트 파일별 그룹",
        "test_item": "개별 테스트 케이스",
        "status_icon": "통과/실패/스킵 아이콘",
        "duration": "실행 시간"
      }
    },
    "test_detail": {
      "description": "테스트 상세 정보 (클릭 시 확장)",
      "elements": {
        "steps": "테스트 단계별 실행 내역",
        "error_message": "에러 메시지",
        "stack_trace": "스택 트레이스",
        "attachments": "스크린샷, 비디오, 트레이스"
      }
    }
  },

  "selectors": {
    "summary": {
      "stats_container": ".subnav-item",
      "passed_count": ".subnav-item:has-text('Passed') .counter",
      "failed_count": ".subnav-item:has-text('Failed') .counter",
      "flaky_count": ".subnav-item:has-text('Flaky') .counter",
      "skipped_count": ".subnav-item:has-text('Skipped') .counter"
    },
    "test_list": {
      "all_tests": ".test-file-test",
      "failed_tests": ".test-file-test.failed",
      "passed_tests": ".test-file-test.passed",
      "test_title": ".test-file-title",
      "test_duration": ".test-file-test .duration"
    },
    "test_detail": {
      "error_message": ".test-result-error-message",
      "stack_trace": ".test-result-error pre",
      "screenshot": ".attachment-thumbnail img",
      "video": ".attachment-thumbnail video",
      "trace_link": ".attachment-link:has-text('trace')"
    },
    "navigation": {
      "failed_filter": "text=Failed",
      "passed_filter": "text=Passed",
      "all_filter": "text=All"
    }
  },

  "mcp_workflow": {
    "description": "Playwright MCP를 사용한 리포트 분석 워크플로우",
    "prerequisite": "Playwright MCP 서버가 Claude에 연결되어 있어야 함",
    "steps": [
      {
        "step": 1,
        "action": "playwright_navigate",
        "description": "리포트 페이지 접속",
        "params": {
          "url": "{report_url}"
        }
      },
      {
        "step": 2,
        "action": "playwright_screenshot",
        "description": "전체 리포트 스크린샷 캡처",
        "params": {
          "name": "report-overview"
        }
      },
      {
        "step": 3,
        "action": "playwright_click",
        "description": "실패 테스트 필터 클릭",
        "params": {
          "selector": "text=Failed"
        }
      },
      {
        "step": 4,
        "action": "playwright_screenshot",
        "description": "실패 테스트 목록 스크린샷",
        "params": {
          "name": "failed-tests-list"
        }
      },
      {
        "step": 5,
        "action": "playwright_click",
        "description": "첫 번째 실패 테스트 클릭 (상세 보기)",
        "params": {
          "selector": ".test-file-test.failed >> nth=0"
        }
      },
      {
        "step": 6,
        "action": "playwright_screenshot",
        "description": "실패 테스트 상세 정보 스크린샷",
        "params": {
          "name": "failed-test-detail"
        }
      }
    ]
  },

  "analysis_workflow": {
    "step_1_access": {
      "name": "리포트 페이지 접속",
      "description": "Playwright MCP로 리포트 URL에 접속",
      "output": "페이지 로딩 완료 확인"
    },
    "step_2_overview": {
      "name": "전체 요약 확인",
      "description": "통과/실패/스킵 테스트 수 파악",
      "output": {
        "total_tests": "number",
        "passed": "number",
        "failed": "number",
        "flaky": "number",
        "skipped": "number",
        "pass_rate": "percentage"
      }
    },
    "step_3_failed_list": {
      "name": "실패 테스트 목록 추출",
      "description": "실패한 테스트들의 ID와 설명 수집",
      "output": [
        {
          "test_id": "string",
          "test_name": "string",
          "duration": "string",
          "file_path": "string"
        }
      ]
    },
    "step_4_detail_analysis": {
      "name": "실패 테스트 상세 분석",
      "description": "각 실패 테스트의 에러 메시지, 스크린샷 분석",
      "output": {
        "error_message": "string",
        "error_location": "string",
        "screenshot_description": "string",
        "failure_pattern": "AUTH|SELECTOR|TIMING|NAVIGATION|API|STATE"
      }
    },
    "step_5_pattern_grouping": {
      "name": "패턴별 그룹화",
      "description": "실패 원인별로 테스트 그룹화",
      "reference": "test-analysis-prompt.json의 failure_patterns 참조"
    },
    "step_6_recommendations": {
      "name": "개선 방안 도출",
      "description": "그룹화된 패턴별 해결책 제시",
      "reference": "test-analysis-prompt.json의 solutions 참조"
    }
  },

  "ai_analysis_prompt": {
    "system": "당신은 E2E 테스트 전문가입니다. Playwright HTML 리포트 페이지를 분석하고 테스트 결과를 점검합니다. Playwright MCP를 사용하여 브라우저를 제어하고 리포트 페이지의 정보를 수집할 수 있습니다.",

    "user_template": "다음 Playwright 테스트 리포트를 분석해주세요.\n\n## 리포트 URL\n{report_url}\n\n## 분석 요청사항\n1. 리포트 페이지에 접속하여 전체 테스트 결과 요약을 확인해주세요.\n2. 실패한 테스트들의 목록을 추출해주세요.\n3. 각 실패 테스트의 에러 메시지와 스크린샷을 확인해주세요.\n4. 실패 원인을 패턴별로 분류하고 개선 방안을 제시해주세요.\n\n## 분석 참조 파일\n- 실패 패턴 분류: src/tests/e2e/test-analysis-prompt.json\n\n## 출력 형식\n아래 형식으로 분석 결과를 제공해주세요.",

    "output_format": {
      "summary": {
        "report_url": "string",
        "analyzed_at": "datetime",
        "total_tests": "number",
        "passed": "number",
        "failed": "number",
        "skipped": "number",
        "pass_rate": "percentage"
      },
      "failed_tests": [
        {
          "test_id": "string",
          "test_name": "string",
          "error_message": "string",
          "failure_pattern": "AUTH|SELECTOR|TIMING|NAVIGATION|API|STATE",
          "screenshot_analysis": "string"
        }
      ],
      "pattern_summary": {
        "AUTH": { "count": 0, "tests": [] },
        "SELECTOR": { "count": 0, "tests": [] },
        "TIMING": { "count": 0, "tests": [] },
        "NAVIGATION": { "count": 0, "tests": [] },
        "API": { "count": 0, "tests": [] },
        "STATE": { "count": 0, "tests": [] }
      },
      "recommendations": [
        {
          "priority": 1,
          "pattern": "string",
          "issue": "string",
          "affected_tests": ["string"],
          "solution": "string",
          "code_example": "string"
        }
      ],
      "next_steps": [
        "string"
      ]
    }
  },

  "quick_prompts": {
    "full_analysis": "다음 Playwright 리포트를 전체 분석해주세요: {url}\n\n분석 프롬프트: src/tests/e2e/playwright-report-analysis-prompt.json",

    "failed_only": "다음 Playwright 리포트에서 실패한 테스트만 분석해주세요: {url}\n\n실패 테스트들의 에러 메시지와 스크린샷을 확인하고, 각 실패의 원인과 해결 방안을 제시해주세요.",

    "pattern_grouping": "다음 Playwright 리포트의 실패 테스트들을 패턴별로 그룹화해주세요: {url}\n\n분류 기준: AUTH(인증), SELECTOR(셀렉터), TIMING(타이밍), NAVIGATION(네비게이션), API(API), STATE(상태)",

    "priority_fixes": "다음 Playwright 리포트를 분석하고, 가장 시급하게 수정해야 할 테스트들을 우선순위별로 정리해주세요: {url}\n\n각 수정 사항에 대해 구체적인 코드 예시를 포함해주세요."
  },

  "integration": {
    "description": "기존 test-analysis-prompt.json과의 연동",
    "failure_patterns_ref": "test-analysis-prompt.json의 failure_patterns 섹션 참조",
    "solutions_ref": "test-analysis-prompt.json의 해당 패턴 solutions 참조",
    "improvement_templates_ref": "test-analysis-prompt.json의 improvement_templates 참조"
  },

  "examples": {
    "example_analysis_request": {
      "user_input": "https://playwright-report-azure.vercel.app/ 이 Playwright 리포트를 분석해주세요.",
      "expected_workflow": [
        "1. Playwright MCP로 해당 URL 접속",
        "2. 전체 테스트 요약 스크린샷 캡처",
        "3. 통과/실패 수치 확인",
        "4. 실패 테스트 목록으로 필터링",
        "5. 각 실패 테스트 상세 정보 확인",
        "6. 에러 메시지 분석 및 패턴 분류",
        "7. 개선 방안 제시"
      ],
      "expected_output_sample": {
        "summary": {
          "report_url": "https://playwright-report-azure.vercel.app/",
          "analyzed_at": "2025-12-20T23:30:00",
          "total_tests": 45,
          "passed": 38,
          "failed": 5,
          "skipped": 2,
          "pass_rate": "84.4%"
        },
        "failed_tests": [
          {
            "test_id": "M02-F01-01",
            "test_name": "사용자명과 인사말이 표시되는가?",
            "error_message": "Timeout waiting for selector '.user-greeting'",
            "failure_pattern": "AUTH",
            "screenshot_analysis": "스크린샷에서 로그인 페이지가 표시됨. 인증이 필요한 페이지에 비인증 상태로 접근한 것으로 보임."
          }
        ],
        "recommendations": [
          {
            "priority": 1,
            "pattern": "AUTH",
            "issue": "인증이 필요한 라우트에 비인증 상태로 접근",
            "affected_tests": ["M02-F01-01", "M04-F01-01"],
            "solution": "테스트 전 localStorage에 mock 인증 토큰 설정",
            "code_example": "await page.evaluate(() => { localStorage.setItem('authToken', 'mock_token'); });"
          }
        ]
      }
    }
  }
}
