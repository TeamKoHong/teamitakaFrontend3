{
  "verification_name": "apiFetch 마이그레이션 기능 검증",
  "version": "1.0.0",
  "created_at": "2025-01-26",
  "description": "서비스 파일 apiFetch 래퍼 마이그레이션 후 기존 기능 정상 동작 검증",
  "purpose": "401 에러 및 '사용자를 찾을 수 없습니다.' 응답 시 자동 로그인 리다이렉트 전역 처리",

  "migration_summary": {
    "total_files_migrated": 9,
    "total_fetch_calls_converted": 53,
    "migrated_files": [
      "dashboard.js",
      "projects.js",
      "recruitment.js",
      "user.js",
      "evaluation.js",
      "profile.js",
      "rating.js",
      "notification.js",
      "phoneAuth.js"
    ],
    "files_excluded": [
      {
        "file": "auth.js",
        "reason": "순환 의존성 - apiFetch가 getApiConfig()를 import함"
      },
      {
        "file": "useSmsAuth.ts",
        "reason": "409 에러 등 특화된 로직 있음"
      },
      {
        "file": "findAccount.js",
        "reason": "Mock API만 사용, fetch 없음"
      },
      {
        "file": "phoneVerify.js",
        "reason": "Firebase Phone Auth 사용, fetch 없음"
      }
    ]
  },

  "test_categories": [
    {
      "category": "DASHBOARD",
      "service_file": "src/services/dashboard.js",
      "functions_count": 9,
      "test_cases": [
        {
          "id": "DASH-001",
          "name": "대시보드 요약 조회",
          "function": "getSummary()",
          "endpoint": "GET /api/dashboard/summary",
          "expected_behavior": "진행중/완료/평가필요 프로젝트 수 반환",
          "verification_steps": [
            "로그인 후 대시보드 페이지 접근",
            "프로젝트 카운트 카드 표시 확인",
            "Network 탭에서 200 응답 확인"
          ]
        },
        {
          "id": "DASH-002",
          "name": "내 프로젝트 조회",
          "function": "getMyProjects()",
          "endpoint": "GET /api/projects/mine",
          "expected_behavior": "사용자의 프로젝트 목록 반환"
        },
        {
          "id": "DASH-003",
          "name": "할 일 목록 조회",
          "function": "getTodos()",
          "endpoint": "GET /api/todos",
          "expected_behavior": "할 일 목록 반환"
        },
        {
          "id": "DASH-004",
          "name": "알림 목록 조회",
          "function": "getNotifications()",
          "endpoint": "GET /api/notifications",
          "expected_behavior": "알림 목록 반환"
        },
        {
          "id": "DASH-005",
          "name": "읽지 않은 알림 수",
          "function": "getNotificationUnreadCount()",
          "endpoint": "GET /api/notifications/unread-count",
          "expected_behavior": "읽지 않은 알림 개수 반환"
        },
        {
          "id": "DASH-006",
          "name": "모든 알림 읽음 처리",
          "function": "markAllNotificationsRead()",
          "endpoint": "PUT /api/notifications/read-all",
          "expected_behavior": "모든 알림 읽음 상태로 변경"
        },
        {
          "id": "DASH-007",
          "name": "단일 알림 읽음 처리",
          "function": "markNotificationRead(notificationId)",
          "endpoint": "PUT /api/notifications/:id/read",
          "expected_behavior": "특정 알림 읽음 상태로 변경"
        },
        {
          "id": "DASH-008",
          "name": "알림 삭제",
          "function": "deleteNotification(notificationId)",
          "endpoint": "DELETE /api/notifications/:id",
          "expected_behavior": "특정 알림 삭제"
        },
        {
          "id": "DASH-009",
          "name": "다가오는 일정 조회",
          "function": "getUpcomingSchedules()",
          "endpoint": "GET /api/schedules/upcoming",
          "expected_behavior": "향후 일정 목록 반환"
        }
      ]
    },
    {
      "category": "PROJECTS",
      "service_file": "src/services/projects.js",
      "functions_count": 14,
      "test_cases": [
        {
          "id": "PROJ-001",
          "name": "프로젝트 생성",
          "function": "createProject(projectData)",
          "endpoint": "POST /api/projects",
          "expected_behavior": "새 프로젝트 생성 후 데이터 반환",
          "requires_auth": true
        },
        {
          "id": "PROJ-002",
          "name": "내 프로젝트 목록 조회",
          "function": "getMyProjects(options)",
          "endpoint": "GET /api/projects/mine",
          "expected_behavior": "사용자의 프로젝트 목록 (status, limit, offset 파라미터)"
        },
        {
          "id": "PROJ-003",
          "name": "즐겨찾기 프로젝트 조회",
          "function": "getFavoriteProjects(options)",
          "endpoint": "GET /api/projects/mine?isFavorite=true",
          "expected_behavior": "즐겨찾기 프로젝트만 반환"
        },
        {
          "id": "PROJ-004",
          "name": "프로젝트 즐겨찾기 토글",
          "function": "toggleProjectFavorite(projectId)",
          "endpoint": "PUT /api/projects/:id/favorite",
          "expected_behavior": "즐겨찾기 상태 토글"
        },
        {
          "id": "PROJ-005",
          "name": "프로젝트 상세 조회",
          "function": "fetchProjectDetails(projectId)",
          "endpoint": "GET /api/projects/:id",
          "expected_behavior": "프로젝트 상세 정보 반환"
        },
        {
          "id": "PROJ-006",
          "name": "프로젝트 멤버 조회",
          "function": "fetchProjectMembers(projectId)",
          "endpoint": "GET /api/projects/:id/members",
          "expected_behavior": "프로젝트 멤버 목록 반환"
        },
        {
          "id": "PROJ-007",
          "name": "회의록 목록 조회",
          "function": "getProjectMeetings(projectId)",
          "endpoint": "GET /api/projects/:id/meetings",
          "expected_behavior": "회의록 목록 반환"
        },
        {
          "id": "PROJ-008",
          "name": "회의록 생성",
          "function": "createMeeting(projectId, meetingData)",
          "endpoint": "POST /api/projects/:id/meetings",
          "expected_behavior": "새 회의록 생성"
        },
        {
          "id": "PROJ-009",
          "name": "프로젝트 일정 조회",
          "function": "getProjectSchedules(projectId)",
          "endpoint": "GET /api/schedule/project/:id",
          "expected_behavior": "프로젝트 일정 목록 반환"
        },
        {
          "id": "PROJ-010",
          "name": "멤버 역할/담당 수정",
          "function": "updateProjectMembers(projectId, members)",
          "endpoint": "PUT /api/projects/:id/members",
          "expected_behavior": "멤버 역할 및 담당 업무 수정"
        },
        {
          "id": "PROJ-011",
          "name": "프로젝트 Todo 조회",
          "function": "getProjectTodos(projectId)",
          "endpoint": "GET /api/projects/:id/todo",
          "expected_behavior": "Todo 목록 반환"
        },
        {
          "id": "PROJ-012",
          "name": "프로젝트 Todo 수정",
          "function": "updateProjectTodo(projectId, todoId, updateData)",
          "endpoint": "PUT /api/projects/:id/todo/:todoId",
          "expected_behavior": "Todo 상태/내용 수정"
        },
        {
          "id": "PROJ-013",
          "name": "프로젝트 Todo 생성",
          "function": "createProjectTodo(projectId, content)",
          "endpoint": "POST /api/projects/:id/todo",
          "expected_behavior": "새 Todo 생성"
        },
        {
          "id": "PROJ-014",
          "name": "활동 로그 조회",
          "function": "getProjectActivityLogs(projectId, limit, offset)",
          "endpoint": "GET /api/projects/:id/activity-log",
          "expected_behavior": "팀원 활동 로그 반환"
        }
      ]
    },
    {
      "category": "RECRUITMENT",
      "service_file": "src/services/recruitment.js",
      "functions_count": 15,
      "test_cases": [
        {
          "id": "RECR-001",
          "name": "모집공고 생성",
          "function": "createRecruitment(recruitmentData)",
          "endpoint": "POST /api/recruitments",
          "expected_behavior": "새 모집공고 생성",
          "requires_auth": true
        },
        {
          "id": "RECR-002",
          "name": "모집공고 이미지 업로드",
          "function": "uploadRecruitmentImage(imageFile)",
          "endpoint": "POST /api/upload/recruitment-image",
          "content_type": "multipart/form-data",
          "special_note": "Content-Type: undefined 설정으로 브라우저가 boundary 자동 설정"
        },
        {
          "id": "RECR-003",
          "name": "모집공고 상세 조회",
          "function": "getRecruitment(recruitmentId)",
          "endpoint": "GET /api/recruitments/:id",
          "expected_behavior": "모집공고 상세 정보 반환"
        },
        {
          "id": "RECR-004",
          "name": "지원자 목록 조회",
          "function": "getRecruitmentApplicants(recruitmentId)",
          "endpoint": "GET /api/recruitments/:id/applications",
          "expected_behavior": "지원자 목록 반환"
        },
        {
          "id": "RECR-005",
          "name": "지원자 승인",
          "function": "approveApplicant(applicationId)",
          "endpoint": "POST /api/applications/:id/approve",
          "expected_behavior": "지원자 승인 처리"
        },
        {
          "id": "RECR-006",
          "name": "지원서 제출",
          "function": "submitApplication(recruitmentId, applicationData)",
          "endpoint": "POST /api/applications/:id",
          "expected_behavior": "지원서 제출 완료"
        },
        {
          "id": "RECR-007",
          "name": "지원 취소",
          "function": "cancelApplication(applicationId)",
          "endpoint": "POST /api/applications/:id/cancel",
          "expected_behavior": "지원 취소 처리"
        },
        {
          "id": "RECR-008",
          "name": "내 지원 목록 조회",
          "function": "getMyApplications()",
          "endpoint": "GET /api/applications/mine",
          "expected_behavior": "사용자의 지원 목록 반환"
        },
        {
          "id": "RECR-009",
          "name": "프로젝트 전환",
          "function": "convertToProject(recruitmentId)",
          "endpoint": "POST /api/projects/from-recruitment/:id",
          "expected_behavior": "모집공고를 프로젝트로 전환"
        },
        {
          "id": "RECR-010",
          "name": "내 모집공고 목록 조회",
          "function": "getMyRecruitments(options)",
          "endpoint": "GET /api/recruitments/mine",
          "expected_behavior": "사용자가 작성한 모집공고 목록"
        },
        {
          "id": "RECR-011",
          "name": "모집공고 수정",
          "function": "updateRecruitment(recruitmentId, recruitmentData)",
          "endpoint": "PUT /api/recruitments/:id",
          "expected_behavior": "모집공고 정보 수정"
        },
        {
          "id": "RECR-012",
          "name": "모집공고 삭제",
          "function": "deleteRecruitment(recruitmentId)",
          "endpoint": "DELETE /api/recruitments/:id",
          "expected_behavior": "모집공고 삭제"
        },
        {
          "id": "RECR-013",
          "name": "북마크 토글",
          "function": "toggleRecruitmentScrap(recruitmentId)",
          "endpoint": "PUT /api/scraps/recruitment/:id/scrap",
          "expected_behavior": "모집공고 북마크 추가/취소"
        },
        {
          "id": "RECR-014",
          "name": "북마크 목록 조회",
          "function": "getBookmarkedRecruitments()",
          "endpoint": "GET /api/scraps/recruitments",
          "expected_behavior": "북마크한 모집공고 목록"
        },
        {
          "id": "RECR-015",
          "name": "킥오프 프로젝트 생성",
          "function": "createProjectFromRecruitment(recruitmentId, kickoffData)",
          "endpoint": "POST /api/projects/from-recruitment/:id",
          "expected_behavior": "모집 완료 후 프로젝트 생성"
        }
      ]
    },
    {
      "category": "USER",
      "service_file": "src/services/user.js",
      "functions_count": 4,
      "test_cases": [
        {
          "id": "USER-001",
          "name": "내 정보 조회",
          "function": "getMe()",
          "endpoint": "GET /api/auth/me",
          "expected_behavior": "현재 로그인한 사용자 정보 반환"
        },
        {
          "id": "USER-002",
          "name": "프로필 이미지 업로드",
          "function": "uploadProfileImage(imageFile)",
          "endpoint": "POST /api/upload/profile-image",
          "content_type": "multipart/form-data",
          "special_note": "Content-Type: undefined 설정"
        },
        {
          "id": "USER-003",
          "name": "프로필 수정",
          "function": "updateProfile(profileData)",
          "endpoint": "PUT /api/profile",
          "expected_behavior": "프로필 정보 수정"
        },
        {
          "id": "USER-004",
          "name": "타입 테스트 결과 저장",
          "function": "saveTypeResult(resultData)",
          "endpoint": "POST /api/user/type-result",
          "expected_behavior": "유형 테스트 결과 저장"
        }
      ]
    },
    {
      "category": "EVALUATION",
      "service_file": "src/services/evaluation.js",
      "functions_count": 4,
      "test_cases": [
        {
          "id": "EVAL-001",
          "name": "평가 제출",
          "function": "submitEvaluation(projectId, reviewerId, revieweeId, evaluationData)",
          "endpoint": "POST /api/reviews",
          "expected_behavior": "팀원 평가 제출"
        },
        {
          "id": "EVAL-002",
          "name": "프로젝트 평가 조회",
          "function": "fetchProjectReviews(projectId)",
          "endpoint": "GET /api/reviews/project/:id",
          "expected_behavior": "프로젝트의 모든 평가 반환"
        },
        {
          "id": "EVAL-003",
          "name": "프로젝트 멤버 조회",
          "function": "fetchProjectMembers(projectId)",
          "endpoint": "GET /api/projects/:id/members",
          "expected_behavior": "평가 대상 멤버 목록"
        },
        {
          "id": "EVAL-004",
          "name": "평가 대상 조회",
          "function": "fetchEvaluationTargets(projectId, currentUserId)",
          "endpoint": "Multiple API calls",
          "expected_behavior": "평가 대상 및 완료 상태"
        }
      ]
    },
    {
      "category": "PROFILE",
      "service_file": "src/services/profile.js",
      "functions_count": 2,
      "test_cases": [
        {
          "id": "PROF-001",
          "name": "프로필 상세 조회",
          "function": "getProfileDetail()",
          "endpoint": "GET /api/profile/detail",
          "expected_behavior": "프로필 상세 정보 (skills, feedback 등)"
        },
        {
          "id": "PROF-002",
          "name": "대학 인증 정보 조회",
          "function": "getVerificationInfo()",
          "endpoint": "GET /api/profile/verification",
          "expected_behavior": "대학 인증 상태 및 정보"
        }
      ]
    },
    {
      "category": "RATING",
      "service_file": "src/services/rating.js",
      "functions_count": 4,
      "test_cases": [
        {
          "id": "RATE-001",
          "name": "프로젝트 상세 조회",
          "function": "fetchProjectDetails(projectId)",
          "endpoint": "GET /api/projects/:id",
          "expected_behavior": "평가 페이지용 프로젝트 정보"
        },
        {
          "id": "RATE-002",
          "name": "평가 요약 조회",
          "function": "fetchReviewSummary(projectId)",
          "endpoint": "GET /api/reviews/project/:id/summary",
          "expected_behavior": "평가 요약 (평균 점수, 카테고리별 점수)"
        },
        {
          "id": "RATE-003",
          "name": "내가 한 평가 조회",
          "function": "fetchMyGivenReviews(projectId, userId)",
          "endpoint": "GET /api/reviews/project/:id/reviewer/:userId",
          "expected_behavior": "사용자가 작성한 평가 목록"
        },
        {
          "id": "RATE-004",
          "name": "평가 페이지 데이터 통합 조회",
          "function": "fetchRatingProjectData(projectId, currentUserId)",
          "endpoint": "Multiple API calls",
          "expected_behavior": "평가 페이지에 필요한 모든 데이터"
        }
      ]
    },
    {
      "category": "NOTIFICATION",
      "service_file": "src/services/notification.js",
      "functions_count": 1,
      "test_cases": [
        {
          "id": "NOTI-001",
          "name": "프로젝트 알림 조회",
          "function": "fetchProjectNotifications(projectId)",
          "endpoint": "GET /api/projects/:id/notifications",
          "expected_behavior": "프로젝트 관련 알림 목록"
        }
      ]
    },
    {
      "category": "PHONE_AUTH",
      "service_file": "src/services/phoneAuth.js",
      "functions_count": 1,
      "test_cases": [
        {
          "id": "PHON-001",
          "name": "휴대폰 인증 확인",
          "function": "verifyPhoneAuth(idToken)",
          "endpoint": "POST /api/auth/verify-phone",
          "expected_behavior": "Firebase ID Token 검증 후 JWT 토큰 반환",
          "special_note": "credentials: 'include' 설정으로 HttpOnly 쿠키 수신"
        }
      ]
    }
  ],

  "error_handling_verification": [
    {
      "id": "ERR-001",
      "name": "401 Unauthorized 에러 리다이렉트",
      "priority": "critical",
      "trigger": "토큰 만료 상태에서 API 호출",
      "expected": "로그인 페이지(/login)로 자동 리다이렉트",
      "verification_steps": [
        "1. localStorage에서 authToken 제거",
        "2. 대시보드 페이지 접근 시도",
        "3. API 호출 후 /login 리다이렉트 확인",
        "4. 브라우저 콘솔에서 에러 로그 확인"
      ]
    },
    {
      "id": "ERR-002",
      "name": "'사용자를 찾을 수 없습니다.' 에러 리다이렉트",
      "priority": "critical",
      "trigger": "백엔드에서 { message: '사용자를 찾을 수 없습니다.' } 응답",
      "expected": "로그인 페이지(/login)로 자동 리다이렉트",
      "verification_steps": [
        "1. 백엔드에서 해당 에러 응답하도록 설정 (또는 mock)",
        "2. API 호출 후 리다이렉트 확인",
        "3. 토큰 및 사용자 정보 초기화 확인"
      ]
    },
    {
      "id": "ERR-003",
      "name": "로그인 페이지 예외 처리",
      "priority": "critical",
      "trigger": "/login 페이지에서 401 에러 발생",
      "expected": "리다이렉트 안 됨 (무한 루프 방지)",
      "verification_steps": [
        "1. /login 페이지에서 잘못된 credentials로 로그인 시도",
        "2. 401 에러 발생 확인",
        "3. 페이지 리다이렉트 없이 에러 메시지 표시 확인"
      ]
    },
    {
      "id": "ERR-004",
      "name": "회원가입 페이지 예외 처리",
      "priority": "critical",
      "trigger": "/register 페이지에서 에러 발생",
      "expected": "리다이렉트 안 됨",
      "verification_steps": [
        "1. /register 페이지에서 에러 유발",
        "2. 페이지 리다이렉트 없이 에러 처리 확인"
      ]
    },
    {
      "id": "ERR-005",
      "name": "비즈니스 로직 에러 처리 유지",
      "priority": "high",
      "trigger": "400, 403, 404, 409 등 비즈니스 에러",
      "expected": "각 서비스에서 적절히 처리 (리다이렉트 안 됨)",
      "verification_steps": [
        "1. 권한 없는 리소스 접근 (403)",
        "2. 존재하지 않는 리소스 접근 (404)",
        "3. 에러 메시지가 UI에 적절히 표시되는지 확인"
      ]
    }
  ],

  "file_upload_verification": [
    {
      "id": "UPLOAD-001",
      "name": "프로필 이미지 업로드",
      "service_file": "user.js",
      "function": "uploadProfileImage(imageFile)",
      "endpoint": "POST /api/upload/profile-image",
      "verification": [
        "Content-Type 헤더가 자동 설정되는지 확인",
        "multipart/form-data 경계(boundary) 자동 생성 확인",
        "이미지 업로드 성공 후 URL 반환 확인"
      ]
    },
    {
      "id": "UPLOAD-002",
      "name": "모집공고 이미지 업로드",
      "service_file": "recruitment.js",
      "function": "uploadRecruitmentImage(imageFile)",
      "endpoint": "POST /api/upload/recruitment-image",
      "verification": [
        "Content-Type: undefined 설정 확인",
        "5MB 파일 크기 제한 동작 확인",
        "jpeg, png, webp 형식만 허용 확인"
      ]
    }
  ],

  "regression_checklist": {
    "critical": [
      {
        "item": "로그인/로그아웃",
        "description": "사용자 인증 플로우 정상 동작",
        "test_pages": ["/login", "/"]
      },
      {
        "item": "프로젝트 CRUD",
        "description": "프로젝트 생성/조회/수정/삭제",
        "test_pages": ["/projects", "/projects/:id"]
      },
      {
        "item": "모집공고 CRUD",
        "description": "모집공고 생성/조회/수정/삭제/지원",
        "test_pages": ["/team-matching", "/recruitment/:id"]
      },
      {
        "item": "평가 시스템",
        "description": "팀원 평가 제출 및 조회",
        "test_pages": ["/rating/:projectId"]
      },
      {
        "item": "프로필 관리",
        "description": "프로필 조회 및 수정",
        "test_pages": ["/my-page", "/profile-setup"]
      }
    ],
    "high": [
      {
        "item": "대시보드 데이터 로딩",
        "description": "대시보드 요약 정보 표시",
        "test_pages": ["/"]
      },
      {
        "item": "알림 시스템",
        "description": "알림 조회/읽음 처리/삭제",
        "test_pages": ["/notifications"]
      },
      {
        "item": "팀원 관리",
        "description": "프로젝트 팀원 역할 수정",
        "test_pages": ["/projects/:id"]
      },
      {
        "item": "회의록 관리",
        "description": "회의록 생성 및 조회",
        "test_pages": ["/projects/:id/meetings"]
      }
    ],
    "medium": [
      {
        "item": "이미지 업로드",
        "description": "프로필/모집공고 이미지 업로드",
        "test_pages": ["/profile-setup", "/recruitment/new"]
      },
      {
        "item": "북마크 기능",
        "description": "모집공고/프로젝트 북마크",
        "test_pages": ["/team-matching", "/projects"]
      },
      {
        "item": "일정 관리",
        "description": "프로젝트 일정 조회",
        "test_pages": ["/projects/:id"]
      }
    ]
  },

  "manual_test_commands": {
    "run_all_e2e_tests": "npx playwright test --reporter=list",
    "run_specific_module": "npx playwright test --grep 'Dashboard' --reporter=list",
    "run_with_debug": "DEBUG=true npx playwright test --reporter=list",
    "start_dev_server": "npm run dev",
    "check_network_tab": "브라우저 개발자 도구 > Network 탭에서 API 요청/응답 확인"
  },

  "browser_console_verification": {
    "success_indicators": [
      "API 호출 시 200/201 응답",
      "apiFetch 래퍼를 통한 요청 (URL에 API_BASE_URL 포함)",
      "Authorization 헤더 자동 포함"
    ],
    "failure_indicators": [
      "401 에러 후 /login 리다이렉트",
      "네트워크 에러 로그",
      "CORS 에러"
    ]
  },

  "expected_results": {
    "all_services_working": {
      "status": "expected",
      "description": "모든 서비스 함수가 정상 동작"
    },
    "auth_redirect_working": {
      "status": "expected",
      "description": "401 및 '사용자를 찾을 수 없습니다.' 에러 시 리다이렉트"
    },
    "no_regression": {
      "status": "expected",
      "description": "기존 기능 모두 정상 동작"
    },
    "file_upload_working": {
      "status": "expected",
      "description": "multipart/form-data 업로드 정상 동작"
    },
    "auth_page_exception": {
      "status": "expected",
      "description": "로그인/회원가입 페이지에서 리다이렉트 안 됨"
    }
  }
}
